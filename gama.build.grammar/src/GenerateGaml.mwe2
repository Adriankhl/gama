module GenerateGaml

import org.eclipse.emf.mwe.utils.*
import org.eclipse.xtext.xtext.generator.*
import org.eclipse.xtext.xtext.ui.generator.*
import java.util.*

var runtimeProject = "gama.core.lang"
var ideProjectName = "gama.ui.modeling"

Workflow {
	bean = StandaloneSetup {
		scanClassPath = false
		platformUri = "../${runtimeProject}/.."
	}

	component = DirectoryCleaner {
		directory = "${runtimeProject}/src-gen"
	}

	component = DirectoryCleaner {
		directory = "${ideProjectName}/src-gen"
	}

	component = XtextGenerator {
		configuration = {
			project = model.project.StandardProjectConfig {
				baseName = "gama.core.lang"
				rootPath = ".."
				
				runtime = {
					name = runtimeProject
				}
				runtimeTest = {
					enabled = false
				}
				eclipsePlugin = {
					enabled = true
					name = ideProjectName
				}
				genericIde = {
					enabled = true
					name = ideProjectName
				}
				eclipsePluginTest = {
					enabled = false
				}
				createEclipseMetaData = true
			}
			code = {
				preferXtendStubs = false
				encoding = 'UTF-8'
			}
		}
		language = StandardLanguage {
			grammarUri = "src/Gaml.xtext"
			name = "gama.core.lang.Gaml"
			fileExtensions = "gaml,experiment"
			parserGenerator = {
				lookaheadThreshold = '5'
				removeBacktrackingGuards = true
				options = {
					backtrack = true
					memoize = true
					optimizeCodeQuality = true
					stripAllComments = true
					skipUnusedRules = true
				}
			}
			validator = {
				generatePropertyPage = true
				generateXtendStub = false
				
			}
			generator = {
				generateXtendMain = false
				generateXtendStub = false
			}
			contentAssist = {
				generateXtendStub = false
			}
			formatter = {
				generateXtendStub = false
			}
			junitSupport = {
				generateStub = false
				generateXtendStub = false
			}
			labelProvider = {
				generateXtendStub = false
			}
			scopeProvider = {
				generateXtendStub = false
			}
			serializer = {
				generateXtendStub = false
			}
		}

	}
}
