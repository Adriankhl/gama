/**
* Name: Spatial Operators
* Author: Patrick Taillandier
* Description: Tests various spatial relation operators (distance_to) with continuous and grid topology
* Tags: topology, grid, relation, test
*/

model RelationTest

species dummy {
	rgb color <- #yellow;
	aspect default {
		draw circle(2) border: #black color: color;
		draw string(int(self)) color: #black;
	}
}
grid cell width: 10 height: 10 neighbors: 4 {
	rgb color <- #white;
	aspect default {
		draw shape border: #black color: color;
		draw string(int(self)) color: #black;
	}
}

global {
	init {
		create dummy with: [location :: {5,5}];
		create dummy with: [location :: {8,9}];
		create dummy with: [location :: {14,6}];
		create dummy with: [location :: {35,55}];
		create dummy with: [location :: {25,75}];
		create dummy with: [location :: {56,80}];
		create dummy with: [location :: {10,70}];
		create dummy with: [location :: {80,8}];
		create dummy with: [location :: {34,78}];
		create dummy with: [location :: {67,32}];
		ask dummy(8) {color<-#red;}
		ask cell(40) {color<-#red;}
	}
}
experiment RelationTests type: test {
	test "distance_to with continuous topology" {
		float distance <- dummy(8) distance_to dummy(9);
		assert (distance with_precision 3)= 56.613;
	}
	test "distance_to with grid topology" {
		float distance;
		using topology(cell) {distance <- dummy(8) distance_to dummy(9);}
		assert distance = 7.0;
	}
} 

experiment with_visualization type: gui {
	output {
		display map {
			species cell;
			species dummy;
		}	
	}	
}

